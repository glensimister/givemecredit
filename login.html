<!DOCTYPE html>
<html lang="en">

<head>
    <title>GiveMeCredit V1</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/buttons.css">
    <link rel="stylesheet" href="css/left.css">
    <link rel="stylesheet" href="css/grid.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/select2.min.css">
    <!--<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">-->
    <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
    <script src="js/vendor/select2.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gun/sea.js"></script>
    <!--<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>-->

    <style>
        .user-login {
            display:none;
        }
    </style>

    <script>
        document.write("<base href='" + window.location.href + "' />");
        $(document).ready(function() {
            var gun = Gun();
            var user = gun.user();
            $('.create-user').on("click", function(e) {
                e.stopImmediatePropagation();
                var name = $('.user-name').val();
                var password = $('.password').val();
                user.create(name, password, function(result) {
                    var pubKey = result.pub;
                    gun.get('users').put({
                        pubKey: pubKey
                    });
                });
                $('.user-login').show();
            });
            $('.user-login').on("click", function(e) {
                e.stopImmediatePropagation();
                var username = $('.user-name').val();
                var password = $('.password').val();
                var name = $('.name').val();
                var photo = $('.photo').val();
                photo = photo.replace(/.*[\/\\]/, '');
                user.auth(username, password, function(result) {
                    var pubKey = result.sea.pub;
                    var id = pubKey.substring(0, 8);
                    gun.get('pub/' + result.sea.pub).put({
                        id: id,
                        name: name, 
                        photo: 'img/' + photo,
                        voteWeight: 0,
                        educationScore: 0,
                        socialRating: 0,
                        age:0,
                        connections: 0, 
                        likes: 0,
                        dislikes: 0, 
                        about: "Hello! My name is " + name + "."
                    });
                    window.location.replace("index.html");
                })
            });
            $('.clear-storage').on("click", function(e) {
                  localStorage.clear();
            });
        });

    </script>
</head>

<body>
    <div class="sign-in">
        <div class="logo"><a><b><span>D</span>EVOLUTION</b></a></div>
        <br />
        <h4 style="text-align: center">REGISTER</h4>
        <p class="reg-confirmation">Thank you. Please finish registration by fill out the information below.</p>
        <div class="form-group">
            <label for="">User name:</label>
            <input type="text" class="form-control user-name">
        </div>
        <div class="form-group">
            <label for="">Password:</label>
            <input type="password" class="form-control password">
        </div>
        <div class="form-group">
            <label for="">Name:</label>
            <input type="text" class="form-control name">
        </div>
        <div class="form-group">
            <label for="">Profile Photo:</label>
            <input type="file" name="pic" accept="img/*" class="photo">
        </div>
        <button type="submit" class="btn btn-blue create-user">REGISTER</button>
        <button type="submit" class="btn btn-blue clear-storage">CLEAR STORAGE</button>
        <button type="submit" class="btn btn-red user-login">LOGIN</button>
    </div>
</body>

</html>
